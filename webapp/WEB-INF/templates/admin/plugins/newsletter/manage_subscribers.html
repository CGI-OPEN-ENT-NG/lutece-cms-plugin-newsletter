<#macro sort jsp_url attribute newsletterId search_string>
	<a href="${jsp_url}?sorted_attribute_name=${attribute}&asc_sort=true&newsletter_id=${newsletterId}&subscriber_search=${search_string}" >
		<img src="images/admin/skin/actions/sort_asc.gif" style="vertical-align: text-bottom;" alt="#i18n{portal.util.sort.asc}" title="#i18n{portal.util.sort.asc}" />
	</a>
	<a href="${jsp_url}?sorted_attribute_name=${attribute}&asc_sort=false&newsletter_id=${newsletterId}&subscriber_search=${search_string}" >
    	<img src="images/admin/skin/actions/sort_desc.gif" style="vertical-align: text-bottom;" alt="#i18n{portal.util.sort.desc}" title="#i18n{portal.util.sort.desc}" />
    </a>
</#macro>

<script type="text/javascript"> 
	function toggle_checkboxes() {
	    if (!document.getElementById){ return; }
	    if (!document.getElementsByTagName){ return; }
	    var inputs = document.getElementById("subscribers_form").getElementsByTagName("input");
	    for(var x=0; x < inputs.length; x++) {
	        if ( (inputs[x].type == 'checkbox') && (inputs[x].name != "select_all" ) ) {
	            inputs[x].checked = !inputs[x].checked;
	        }
	    }
	} 
</script>

<div class="content-box">
    <h2>#i18n{newsletter.manage_subscribers.boxTitle}</h2>
    
    <p>
        <h3>#i18n{newsletter.manage_subscribers.searchTitle} :</h3>
        <form method="post" action="jsp/admin/plugins/newsletter/ManageSubscribers.jsp">
            <input size="30" type="text"  name="subscriber_search" value="" />
            <input type="hidden" name="newsletter_id" value="${newsletter.id}" />
            <input type="submit" value="#i18n{newsletter.manage_subscribers.buttonSearch}" class="button" />
        </form>
    </p>
    <h3>#i18n{newsletter.manage_subscribers.listTitle}</h3>
    <form method="post" action="jsp/admin/plugins/newsletter/ManageSubscribers.jsp">
        <@pagination paginator=paginator />
        <input type="hidden" name="newsletter_id" value="${newsletter.id}" />
        <input type="hidden" name="subscriber_search" value="${search_string}" />
        <!-- Number of users per page selector -->
        #i18n{portal.users.manage_users.labelItemsPerPage} :
        <select name="items_per_page">
            <#list [ "10" , "20" , "50" , "100" ] as nb>
            <#if nb_items_per_page = nb >
            <option selected="selected" value="${nb}">${nb}</option>
            <#else>
            <option value="${nb}">${nb}</option>
            </#if>
            </#list>
        </select>                            
        <input type="submit" class="button" value="#i18n{portal.users.manage_users.buttonItemsPerPage}" />
    </form>  
    <form id="subscribers_form" name="subscribers_form" action="jsp/admin/plugins/newsletter/DoActionSelection.jsp">
    	<input type="hidden" name="newsletter_id" value="${newsletter.id}" />
    	<input type="submit" tabindex="10" class="button" value="#i18n{newsletter.manage_subscribers.buttonDelete}"/>
	    <table>
	        <tr>
	         	<th width="5%"><input id="select_all" name="select_all" type="checkbox" onclick="toggle_checkboxes();" /></th>
	            <th>
	            	#i18n{newsletter.manage_subscribers.columnTitleEmail}
	            	<@sort jsp_url="jsp/admin/plugins/newsletter/ManageSubscribers.jsp" attribute="email" newsletterId="${newsletter.id}" search_string="${search_string}"/>
	            </th>
	            <th>
	            	#i18n{newsletter.manage_subscribers.columnTitleSubscriptionDate}
	            	<@sort jsp_url="jsp/admin/plugins/newsletter/ManageSubscribers.jsp" attribute="dateSubscription" newsletterId="${newsletter.id}" search_string="${search_string}"/>
	            </th>
	            <#if display_status>
	            <th>
	            	#i18n{newsletter.manage_subscribers.columnTitleStatus}
	            	<@sort jsp_url="jsp/admin/plugins/newsletter/ManageSubscribers.jsp" attribute="confirmed" newsletterId="${newsletter.id}" search_string="${search_string}"/>
	            </th>
	            </#if>
	            <th>
	            	#i18n{newsletter.manage_subscribers.columnTitleDelete}
	            </th>
	        </tr>
	        <#list subscribers_list as subscriber>
	        <tr>
	        	<td>						
					<input id="subscriber_selection" name="subscriber_selection" type="checkbox" value="${subscriber.id}" />
				</td>
	            <td>${subscriber.email}</td>
	            <td>${subscriber.dateSubscription}</td>
	            <#if display_status>
	            <td>
	            	<#if subscriber.confirmed> 
	            	<img src="images/admin/skin/enable.png" alt="#i18n{newsletter.manage_subscribers.enabled}" title="#i18n{newsletter.manage_subscribers.enabled}">
	            	<#else>
	            	<img src="images/admin/skin/disable.png" alt="#i18n{newsletter.manage_subscribers.disabled}" title="#i18n{newsletter.manage_subscribers.disabled}">
	            	</#if>
	            </td>
	            </#if>
	            <td>
	                <a href="jsp/admin/plugins/newsletter/UnsubscribeNewsLetter.jsp?subscriber_id=${subscriber.id}&newsletter_id=${newsletter.id}">
	                    <img src="images/admin/skin/actions/delete.png" border="0">
	                </a>
	            </td>
	        </tr>
	        </#list>
	    </table>
    </form>
    
    <#if is_add_subscriber_right>
	    <p>
	        <form method="post" action="jsp/admin/plugins/newsletter/DoAddSubscriber.jsp">
	            <input size="30" type="text"  name="email" value="" />
	            <input type="hidden" name="newsletter_id" value="${newsletter.id}" />
	            <input type="submit" value="#i18n{newsletter.manage_subscribers.buttonAdd}" class="button" />
	        </form>
	    </p>
    </#if>
    
    <#if is_import_subscriber_right>
	    <p>
	        <form method="post" action="jsp/admin/plugins/newsletter/ImportSubscribers.jsp">
	            <input type="hidden" name="newsletter_id" value="${newsletter.id}" />
	            <input type="submit" value="#i18n{newsletter.manage_subscribers.buttonImport}" class="button" />
	        </form>
	    </p>
    </#if>
</div>
